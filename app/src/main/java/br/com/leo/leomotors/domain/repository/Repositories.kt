package br.com.leo.leomotors.domain.repository

import br.com.leo.leomotors.domain.model.FuelRecord
import br.com.leo.leomotors.domain.model.LocalStateSnapshot
import br.com.leo.leomotors.domain.model.MaintenanceRecord
import br.com.leo.leomotors.domain.model.MaintenanceType
import br.com.leo.leomotors.domain.model.OdometerRecord
import br.com.leo.leomotors.domain.model.Settings
import br.com.leo.leomotors.domain.model.SyncResult
import br.com.leo.leomotors.domain.model.Vehicle
import kotlinx.coroutines.flow.Flow

interface VehicleRepository {
    fun observeVehicles(): Flow<List<Vehicle>>
    suspend fun getVehicles(): List<Vehicle>
    suspend fun ensureDefaultVehiclesIfEmpty()
    suspend fun renameVehicle(vehicleId: Long, name: String)
}

interface RefuelRepository {
    fun observeRefuels(): Flow<List<FuelRecord>>
    suspend fun getRefuels(): List<FuelRecord>
    suspend fun addRefuel(
        vehicleId: Long,
        dateEpochDay: Long,
        odometerKm: Double,
        liters: Double,
        pricePerLiter: Double
    )
}

interface OdometerRepository {
    fun observeOdometerRecords(): Flow<List<OdometerRecord>>
    suspend fun getOdometerRecords(): List<OdometerRecord>
    suspend fun addOdometer(vehicleId: Long, dateEpochDay: Long, odometerKm: Double)
}

interface MaintenanceRepository {
    fun observeMaintenance(): Flow<List<MaintenanceRecord>>
    fun observeMaintenance(vehicleId: Long): Flow<List<MaintenanceRecord>>
    suspend fun getMaintenance(): List<MaintenanceRecord>
    suspend fun addMaintenance(
        vehicleId: Long,
        type: MaintenanceType,
        title: String,
        notes: String,
        createdAtEpochDay: Long,
        dueDateEpochDay: Long?,
        dueOdometerKm: Double?,
        estimatedCost: Double?
    )

    suspend fun setDone(recordId: Long, done: Boolean)
}

interface SettingsRepository {
    fun observeSettings(): Flow<Settings>
    fun observeDarkTheme(): Flow<Boolean>
    suspend fun getSettings(): Settings
    suspend fun setDarkTheme(enabled: Boolean)
    suspend fun markLegacyImportDone()
    suspend fun touchDataUpdatedAt(timestampMillis: Long = System.currentTimeMillis())
}

interface SnapshotRepository {
    suspend fun getSnapshot(): LocalStateSnapshot
    suspend fun restoreSnapshot(snapshot: LocalStateSnapshot)
}

interface SyncRepository {
    fun currentUserEmail(): String?
    fun isSignedIn(): Boolean
    suspend fun signInWithGoogleIdToken(idToken: String): Result<String>
    fun signOut()
    suspend fun uploadLocalState(): Result<SyncResult>
    suspend fun downloadRemoteState(): Result<SyncResult>
    suspend fun syncNow(): Result<SyncResult>
}
